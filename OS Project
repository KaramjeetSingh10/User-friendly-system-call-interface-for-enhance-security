!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure System Call Interface</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --gray: #95a5a6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a3a 0%, #2c3e50 100%);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: var(--gray);
        }
        
        .app-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }
        
        .auth-panel, .call-panel, .logs-panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .panel-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel-title i {
            color: var(--secondary);
        }
        
        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        label {
            font-weight: 500;
            color: var(--gray);
        }
        
        input, select, textarea {
            padding: 12px;
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.2);
            color: white;
            font-size: 1rem;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--secondary);
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background: #219653;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        .user-info {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            display: none;
        }
        
        .user-role {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .role-admin {
            background: var(--danger);
        }
        
        .role-user {
            background: var(--secondary);
        }
        
        .role-auditor {
            background: var(--warning);
            color: var(--dark);
        }
        
        .system-calls {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .call-card {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        
        .call-card:hover {
            transform: translateY(-5px);
            border-color: var(--secondary);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .call-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--secondary);
        }
        
        .call-title {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .call-desc {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .call-form {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
        }
        
        .call-params {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .param-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .logs-container {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        .log-entry {
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            border-left: 4px solid var(--secondary);
        }
        
        .log-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .log-timestamp {
            color: var(--gray);
            font-size: 0.8rem;
        }
        
        .log-user {
            font-weight: 600;
            color: var(--secondary);
        }
        
        .log-call {
            font-weight: 600;
        }
        
        .log-status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status-success {
            background: var(--success);
        }
        
        .status-denied {
            background: var(--danger);
        }
        
        .status-warning {
            background: var(--warning);
            color: var(--dark);
        }
        
        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .filter-btn {
            padding: 8px 15px;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            color: var(--light);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .filter-btn.active {
            background: var(--secondary);
            border-color: var(--secondary);
        }
        
        .alert {
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: none;
        }
        
        .alert-success {
            background: rgba(39, 174, 96, 0.2);
            border: 1px solid var(--success);
        }
        
        .alert-danger {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid var(--danger);
        }
        
        .alert-warning {
            background: rgba(243, 156, 18, 0.2);
            border: 1px solid var(--warning);
        }
        
        .result-panel {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            display: none;
        }
        
        .result-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--secondary);
        }
        
        .result-content {
            font-family: monospace;
            white-space: pre-wrap;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        @media (max-width: 900px) {
            .app-container {
                grid-template-columns: 1fr;
            }
            
            .call-params {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Secure System Call Interface</h1>
            <p class="subtitle">Prevent unauthorized access with enhanced security controls</p>
        </header>
        
        <div class="app-container">
            <div class="auth-panel">
                <h2 class="panel-title">
                    <i>üîê</i> Authentication
                </h2>
                
                <div class="alert alert-success" id="loginSuccess">
                    Login successful! You now have access to system calls.
                </div>
                
                <div class="alert alert-danger" id="loginError">
                    Invalid credentials. Please try again.
                </div>
                
                <form class="auth-form" id="loginForm">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" placeholder="Enter username" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" placeholder="Enter password" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="role">Select Role</label>
                        <select id="role">
                            <option value="user">Standard User</option>
                            <option value="admin">Administrator</option>
                            <option value="auditor">Auditor</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Login</button>
                </form>
                
                <div class="user-info" id="userInfo">
                    <h3>Welcome, <span id="displayName">User</span></h3>
                    <p>Role: <span class="user-role" id="displayRole">user</span></p>
                    <p>Permissions: <span id="displayPermissions">Basic system calls</span></p>
                    <button class="btn btn-danger" id="logoutBtn" style="margin-top: 10px;">Logout</button>
                </div>
            </div>
            
            <div class="call-panel">
                <h2 class="panel-title">
                    <i>‚öôÔ∏è</i> System Calls
                </h2>
                
                <div class="alert alert-warning" id="accessWarning">
                    You don't have permission to execute this system call.
                </div>
                
                <div class="system-calls">
                    <div class="call-card" data-call="file_access">
                        <div class="call-icon">üìÅ</div>
                        <div class="call-title">File Access</div>
                        <div class="call-desc">Read, write, or modify files</div>
                    </div>
                    
                    <div class="call-card" data-call="network">
                        <div class="call-icon">üåê</div>
                        <div class="call-title">Network Operations</div>
                        <div class="call-desc">Manage network connections</div>
                    </div>
                    
                    <div class="call-card" data-call="process">
                        <div class="call-icon">üîß</div>
                        <div class="call-title">Process Control</div>
                        <div class="call-desc">Start, stop, or monitor processes</div>
                    </div>
                    
                    <div class="call-card" data-call="system_info">
                        <div class="call-icon">üíª</div>
                        <div class="call-title">System Information</div>
                        <div class="call-desc">Retrieve system details</div>
                    </div>
                    
                    <div class="call-card" data-call="user_management">
                        <div class="call-icon">üë•</div>
                        <div class="call-title">User Management</div>
                        <div class="call-desc">Manage users and permissions</div>
                    </div>
                    
                    <div class="call-card" data-call="security">
                        <div class="call-icon">üõ°Ô∏è</div>
                        <div class="call-title">Security Operations</div>
                        <div class="call-desc">Security-related functions</div>
                    </div>
                </div>
                
                <div class="call-form" id="callForm">
                    <h3 id="callFormTitle">Execute System Call</h3>
                    <div id="callParamsContainer">
                        <!-- Dynamic parameters will be inserted here -->
                    </div>
                    <form id="executeCallForm">
                        <div class="form-group">
                            <label for="priority">Priority</label>
                            <select id="priority">
                                <option value="low">Low</option>
                                <option value="normal" selected>Normal</option>
                                <option value="high">High</option>
                                <option value="critical">Critical</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="btn btn-success">Execute Call</button>
                    </form>
                </div>
                
                <div class="result-panel" id="resultPanel">
                    <div class="result-title">Execution Result:</div>
                    <div class="result-content" id="resultContent"></div>
                </div>
            </div>
            
            <div class="logs-panel">
                <h2 class="panel-title">
                    <i>üìã</i> Call Logs
                </h2>
                
                <div class="filters">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="success">Success</button>
                    <button class="filter-btn" data-filter="denied">Denied</button>
                    <button class="filter-btn" data-filter="user">My Calls</button>
                </div>
                
                <div class="logs-container" id="logsContainer">
                    <!-- Log entries will be added here dynamically -->
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const loginForm = document.getElementById('loginForm');
            const logoutBtn = document.getElementById('logoutBtn');
            const userInfo = document.getElementById('userInfo');
            const callCards = document.querySelectorAll('.call-card');
            const callForm = document.getElementById('callForm');
            const callParamsContainer = document.getElementById('callParamsContainer');
            const executeCallForm = document.getElementById('executeCallForm');
            const logsContainer = document.getElementById('logsContainer');
            const filterBtns = document.querySelectorAll('.filter-btn');
            const loginSuccess = document.getElementById('loginSuccess');
            const loginError = document.getElementById('loginError');
            const accessWarning = document.getElementById('accessWarning');
            const resultPanel = document.getElementById('resultPanel');
            const resultContent = document.getElementById('resultContent');
            
            // Application State
            let currentUser = null;
            let callLogs = JSON.parse(localStorage.getItem('callLogs')) || [];
            let currentFilter = 'all';
            let currentCallType = null;
            
            // User roles and permissions
            const roles = {
                user: {
                    name: 'Standard User',
                    permissions: ['file_access', 'system_info'],
                    description: 'Basic system calls'
                },
                admin: {
                    name: 'Administrator',
                    permissions: ['file_access', 'network', 'process', 'system_info', 'user_management', 'security'],
                    description: 'Full system access'
                },
                auditor: {
                    name: 'Auditor',
                    permissions: ['system_info'],
                    description: 'Read-only access for auditing'
                }
            };
            
            // System call definitions with parameters
            const systemCalls = {
                file_access: {
                    title: 'File Access',
                    description: 'Access file system operations',
                    requiredRole: 'user',
                    params: [
                        { name: 'operation', type: 'select', label: 'Operation', options: ['read', 'write', 'delete', 'list'], required: true },
                        { name: 'file_path', type: 'text', label: 'File Path', placeholder: '/path/to/file.txt', required: true },
                        { name: 'content', type: 'textarea', label: 'Content (for write)', placeholder: 'File content...', required: false }
                    ]
                },
                network: {
                    title: 'Network Operations',
                    description: 'Manage network connections and services',
                    requiredRole: 'admin',
                    params: [
                        { name: 'operation', type: 'select', label: 'Operation', options: ['connect', 'disconnect', 'scan', 'status'], required: true },
                        { name: 'target', type: 'text', label: 'Target', placeholder: '192.168.1.1 or domain.com', required: true },
                        { name: 'port', type: 'number', label: 'Port', placeholder: '80', required: false }
                    ]
                },
                process: {
                    title: 'Process Control',
                    description: 'Manage system processes',
                    requiredRole: 'admin',
                    params: [
                        { name: 'action', type: 'select', label: 'Action', options: ['list', 'start', 'stop', 'restart', 'kill'], required: true },
                        { name: 'process_id', type: 'number', label: 'Process ID', placeholder: '1234', required: false },
                        { name: 'process_name', type: 'text', label: 'Process Name', placeholder: 'nginx', required: false }
                    ]
                },
                system_info: {
                    title: 'System Information',
                    description: 'Retrieve system details and status',
                    requiredRole: 'user',
                    params: [
                        { name: 'info_type', type: 'select', label: 'Information Type', 
                          options: ['system', 'memory', 'cpu', 'storage', 'network', 'all'], required: true }
                    ]
                },
                user_management: {
                    title: 'User Management',
                    description: 'Manage users and permissions',
                    requiredRole: 'admin',
                    params: [
                        { name: 'action', type: 'select', label: 'Action', 
                          options: ['create', 'delete', 'modify', 'list', 'password'], required: true },
                        { name: 'username', type: 'text', label: 'Username', placeholder: 'john_doe', required: false },
                        { name: 'role', type: 'select', label: 'Role', options: ['user', 'admin', 'auditor'], required: false }
                    ]
                },
                security: {
                    title: 'Security Operations',
                    description: 'Security-related functions and audits',
                    requiredRole: 'admin',
                    params: [
                        { name: 'operation', type: 'select', label: 'Operation', 
                          options: ['audit', 'firewall', 'scan', 'lockdown', 'status'], required: true },
                        { name: 'level', type: 'select', label: 'Security Level', 
                          options: ['low', 'medium', 'high', 'critical'], required: false }
                    ]
                }
            };
            
            // System call simulation functions
            const callSimulations = {
                file_access: function(params) {
                    const operations = {
                        read: Reading file: ${params.file_path}\nFile content: This is simulated content of ${params.file_path}\nSize: ${Math.floor(Math.random() * 10000)} bytes\nModified: ${new Date().toISOString()},
                        write: Writing to file: ${params.file_path}\nContent: ${params.content || '(empty)'}\nWrite successful. File updated.,
                        delete: Deleting file: ${params.file_path}\nFile successfully deleted.,
                        list: Listing directory: ${params.file_path}\n- file1.txt (${Math.floor(Math.random() * 1000)} bytes)\n- file2.log (${Math.floor(Math.random() * 5000)} bytes)\n- subdirectory/
                    };
                    return operations[params.operation] || "Unknown file operation";
                },
                
                network: function(params) {
                    const operations = {
                        connect: Connecting to ${params.target}${params.port ? ':' + params.port : ''}\nConnection established successfully.\nLatency: ${Math.floor(Math.random() * 100)}ms,
                        disconnect: Disconnecting from ${params.target}\nConnection terminated.,
                        scan: Scanning ${params.target}\nOpen ports: 22, 80, 443, 8080\nServices detected: SSH, HTTP, HTTPS,
                        status: Network status for ${params.target}\nStatus: Online\nResponse time: ${Math.floor(Math.random() * 50)}ms
                    };
                    return operations[params.operation] || "Unknown network operation";
                },
                
                process: function(params) {
                    const processes = [
                        { id: 1234, name: "nginx", status: "running", cpu: "2.1%", memory: "45MB" },
                        { id: 5678, name: "mysql", status: "running", cpu: "5.7%", memory: "230MB" },
                        { id: 9012, name: "node", status: "sleeping", cpu: "0.1%", memory: "15MB" },
                        { id: 3456, name: "bash", status: "running", cpu: "0.0%", memory: "1MB" }
                    ];
                    
                    if (params.action === 'list') {
                        let result = "Running Processes:\n";
                        processes.forEach(p => {
                            result += PID: ${p.id}, Name: ${p.name}, Status: ${p.status}, CPU: ${p.cpu}, Memory: ${p.memory}\n;
                        });
                        return result;
                    } else if (params.action === 'start' && params.process_name) {
                        return Starting process: ${params.process_name}\nProcess started successfully with PID: ${Math.floor(Math.random() * 10000)};
                    } else if (params.action === 'stop' && params.process_id) {
                        return Stopping process: ${params.process_id}\nProcess stopped successfully;
                    } else if (params.action === 'kill' && params.process_id) {
                        return Killing process: ${params.process_id}\nProcess terminated;
                    } else if (params.action === 'restart' && params.process_id) {
                        return Restarting process: ${params.process_id}\nProcess restarted successfully;
                    }
                    return "Invalid process operation or missing parameters";
                },
                
                system_info: function(params) {
                    const info = {
                        system: System Information:\nOS: Linux 5.15.0\nKernel: x86_64\nHostname: secure-server-01\nUptime: ${Math.floor(Math.random() * 1000)} hours,
                        memory: Memory Information:\nTotal: 16.0 GB\nUsed: ${(Math.random() * 10).toFixed(1)} GB\nFree: ${(16 - Math.random() * 10).toFixed(1)} GB\nCache: 2.1 GB,
                        cpu: CPU Information:\nModel: Intel Xeon E5-2680\nCores: 8\nUsage: ${Math.floor(Math.random() * 100)}%\nLoad: ${(Math.random() * 5).toFixed(2)},
                        storage: Storage Information:\nTotal: 1.0 TB\nUsed: ${Math.floor(Math.random() * 500)} GB\nFree: ${1000 - Math.floor(Math.random() * 500)} GB\nFilesystem: ext4,
                        network: Network Information:\nInterfaces: eth0, lo\nIP Address: 192.168.1.${Math.floor(Math.random() * 255)}\nGateway: 192.168.1.1\nDNS: 8.8.8.8,
                        all: Complete System Report:\n${this.system(params)}\n\n${this.memory(params)}\n\n${this.cpu(params)}\n\n${this.storage(params)}\n\n${this.network(params)}
                    };
                    return info[params.info_type] || "Unknown information type";
                },
                
                user_management: function(params) {
                    const users = [
                        { username: "admin", role: "admin", last_login: "2023-10-15 14:30:22" },
                        { username: "john_doe", role: "user", last_login: "2023-10-16 09:15:47" },
                        { username: "auditor1", role: "auditor", last_login: "2023-10-14 16:45:33" }
                    ];
                    
                    if (params.action === 'list') {
                        let result = "System Users:\n";
                        users.forEach(u => {
                            result += Username: ${u.username}, Role: ${u.role}, Last Login: ${u.last_login}\n;
                        });
                        return result;
                    } else if (params.action === 'create' && params.username) {
                        return Creating user: ${params.username}\nRole: ${params.role || 'user'}\nUser created successfully;
                    } else if (params.action === 'delete' && params.username) {
                        return Deleting user: ${params.username}\nUser deleted successfully;
                    } else if (params.action === 'modify' && params.username) {
                        return Modifying user: ${params.username}\nNew role: ${params.role || 'user'}\nUser updated successfully;
                    } else if (params.action === 'password' && params.username) {
                        return Changing password for user: ${params.username}\nPassword updated successfully;
                    }
                    return "Invalid user management operation or missing parameters";
                },
                
                security: function(params) {
                    const operations = {
                        audit: Security Audit initiated\nScanning system...\nNo critical issues found\n${Math.floor(Math.random() * 10)} warnings detected,
                        firewall: Firewall ${params.level ? 'set to ' + params.level + ' level' : 'status'}\nRules applied: ${Math.floor(Math.random() * 50) + 20}\nActive connections: ${Math.floor(Math.random() * 100)},
                        scan: Security Scan started\nScanning ports and services...\n${Math.floor(Math.random() * 5)} potential vulnerabilities found,
                        lockdown: System Lockdown initiated\nAll non-essential services stopped\nEmergency protocols activated\nSecurity level: MAXIMUM,
                        status: Security Status:\nFirewall: Active\nIntrusion Detection: Enabled\nLogging: Verbose\nLast incident: ${Math.floor(Math.random() * 24)} hours ago
                    };
                    return operations[params.operation] || "Unknown security operation";
                }
            };
            
            // Initialize the application
            function init() {
                renderLogs();
                setupEventListeners();
                
                // Check if user is already logged in (from localStorage)
                const savedUser = localStorage.getItem('currentUser');
                if (savedUser) {
                    currentUser = JSON.parse(savedUser);
                    updateUIAfterLogin();
                }
            }
            
            // Set up event listeners
            function setupEventListeners() {
                loginForm.addEventListener('submit', handleLogin);
                logoutBtn.addEventListener('click', handleLogout);
                executeCallForm.addEventListener('submit', handleExecuteCall);
                
                callCards.forEach(card => {
                    card.addEventListener('click', function() {
                        if (!currentUser) {
                            showAlert(loginError);
                            return;
                        }
                        
                        const callType = this.getAttribute('data-call');
                        openCallForm(callType);
                    });
                });
                
                filterBtns.forEach(btn => {
                    btn.addEventListener('click', function() {
                        filterBtns.forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                        currentFilter = this.getAttribute('data-filter');
                        renderLogs();
                    });
                });
            }
            
            // Handle user login
            function handleLogin(e) {
                e.preventDefault();
                
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                const role = document.getElementById('role').value;
                
                // Simple authentication (in a real app, this would be server-side)
                if (username && password) {
                    currentUser = {
                        username: username,
                        role: role,
                        loginTime: new Date().toISOString()
                    };
                    
                    // Save to localStorage
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    updateUIAfterLogin();
                    showAlert(loginSuccess);
                    
                    // Log the login event
                    addLog('auth', 'User login', 'success');
                } else {
                    showAlert(loginError);
                }
            }
            
            // Handle user logout
            function handleLogout() {
                // Log the logout event
                addLog('auth', 'User logout', 'success');
                
                currentUser = null;
                localStorage.removeItem('currentUser');
                
                // Update UI
                loginForm.style.display = 'flex';
                userInfo.style.display = 'none';
                callForm.style.display = 'none';
                resultPanel.style.display = 'none';
                
                // Reset forms
                loginForm.reset();
                executeCallForm.reset();
            }
            
            // Update UI after successful login
            function updateUIAfterLogin() {
                loginForm.style.display = 'none';
                userInfo.style.display = 'block';
                
                document.getElementById('displayName').textContent = currentUser.username;
                document.getElementById('displayRole').textContent = currentUser.role;
                document.getElementById('displayRole').className = user-role role-${currentUser.role};
                document.getElementById('displayPermissions').textContent = roles[currentUser.role].description;
            }
            
            // Open the call form for a specific system call
            function openCallForm(callType) {
                const call = systemCalls[callType];
                
                // Check permissions
                if (!roles[currentUser.role].permissions.includes(callType)) {
                    showAlert(accessWarning);
                    addLog(callType, Attempted ${call.title} without permission, 'denied');
                    return;
                }
                
                currentCallType = callType;
                document.getElementById('callFormTitle').textContent = Execute: ${call.title};
                
                // Generate parameter inputs
                callParamsContainer.innerHTML = '';
                if (call.params && call.params.length > 0) {
                    const paramsDiv = document.createElement('div');
                    paramsDiv.className = 'call-params';
                    
                    call.params.forEach(param => {
                        const paramGroup = document.createElement('div');
                        paramGroup.className = 'param-group';
                        
                        const label = document.createElement('label');
                        label.textContent = param.label;
                        label.htmlFor = param-${param.name};
                        
                        let input;
                        if (param.type === 'select') {
                            input = document.createElement('select');
                            input.id = param-${param.name};
                            input.name = param.name;
                            input.required = param.required;
                            
                            param.options.forEach(option => {
                                const optionElem = document.createElement('option');
                                optionElem.value = option;
                                optionElem.textContent = option;
                                input.appendChild(optionElem);
                            });
                        } else if (param.type === 'textarea') {
                            input = document.createElement('textarea');
                            input.id = param-${param.name};
                            input.name = param.name;
                            input.placeholder = param.placeholder || '';
                            input.required = param.required;
                            input.rows = 3;
                        } else {
                            input = document.createElement('input');
                            input.type = param.type;
                            input.id = param-${param.name};
                            input.name = param.name;
                            input.placeholder = param.placeholder || '';
                            input.required = param.required;
                        }
                        
                        paramGroup.appendChild(label);
                        paramGroup.appendChild(input);
                        paramsDiv.appendChild(paramGroup);
                    });
                    
                    callParamsContainer.appendChild(paramsDiv);
                }
                
                callForm.style.display = 'block';
                resultPanel.style.display = 'none';
            }
            
            // Handle system call execution
            function handleExecuteCall(e) {
                e.preventDefault();
                
                const priority = document.getElementById('priority').value;
                
                // Collect parameters
                const params = {};
                const paramInputs = callParamsContainer.querySelectorAll('input, select, textarea');
                paramInputs.forEach(input => {
                    params[input.name] = input.value;
                });
                
                // Execute the system call simulation
                const result = callSimulations[currentCallType](params);
                
                // Display result
                resultContent.textContent = result;
                resultPanel.style.display = 'block';
                
                // Log the call
                addLog(
                    currentCallType, 
                    Executed ${systemCalls[currentCallType].title} with priority: ${priority},
                    'success',
                    JSON.stringify(params, null, 2)
                );
            }
            
            // Add a log entry
            function addLog(callType, message, status, params = '') {
                const logEntry = {
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    user: currentUser ? currentUser.username : 'Unknown',
                    callType: callType,
                    message: message,
                    status: status,
                    params: params
                };
                
                callLogs.unshift(logEntry);
                localStorage.setItem('callLogs', JSON.stringify(callLogs));
                renderLogs();
            }
            
            // Render logs based on current filter
            function renderLogs() {
                logsContainer.innerHTML = '';
                
                let filteredLogs = callLogs;
                
                if (currentFilter === 'success') {
                    filteredLogs = callLogs.filter(log => log.status === 'success');
                } else if (currentFilter === 'denied') {
                    filteredLogs = callLogs.filter(log => log.status === 'denied');
                } else if (currentFilter === 'user' && currentUser) {
                    filteredLogs = callLogs.filter(log => log.user === currentUser.username);
                }
                
                if (filteredLogs.length === 0) {
                    logsContainer.innerHTML = '<div class="log-entry">No logs found</div>';
                    return;
                }
                
                filteredLogs.forEach(log => {
                    const logElement = document.createElement('div');
                    logElement.className = 'log-entry';
                    
                    const date = new Date(log.timestamp);
                    const timeString = date.toLocaleTimeString();
                    const dateString = date.toLocaleDateString();
                    
                    logElement.innerHTML = `
                        <div class="log-header">
                            <span class="log-user">${log.user}</span>
                            <span class="log-timestamp">${dateString} ${timeString}</span>
                        </div>
                        <div>
                            <span class="log-call">${systemCalls[log.callType] ? systemCalls[log.callType].title : log.callType}</span>
                            <span class="log-status status-${log.status}">${log.status.toUpperCase()}</span>
                        </div>
                        <div>${log.message}</div>
                        ${log.params ? <div style="margin-top: 5px; font-size: 0.9rem; color: #95a5a6;">Params: ${log.params}</div> : ''}
                    `;
                    
                    logsContainer.appendChild(logElement);
                });
            }
            
            // Show an alert temporarily
            function showAlert(alertElement) {
                alertElement.style.display = 'block';
                setTimeout(() => {
                    alertElement.style.display = 'none';
                }, 3000);
            }
            
            // Initialize the application
            init();
        });
    </script>
</body>
</html>
